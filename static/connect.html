<!DOCTYPE HTML>
<!--
	Stellar by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/assets/css/main0.css"/>

    <!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
    <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
</head>

  <body>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>

    <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
    <!-- <script src="assets/js/main.js"></script> -->
    <script>
    // $(".content").append("<h1>" + method +  "</h1>");

    function compassHeading(alpha, beta, gamma) {

    // Convert degrees to radians
    var alphaRad = alpha * (Math.PI / 180);
    var betaRad = beta * (Math.PI / 180);
    var gammaRad = gamma * (Math.PI / 180);

    // Calculate equation components
    var cA = Math.cos(alphaRad);
    var sA = Math.sin(alphaRad);
    var cB = Math.cos(betaRad);
    var sB = Math.sin(betaRad);
    var cG = Math.cos(gammaRad);
    var sG = Math.sin(gammaRad);

    // Calculate A, B, C rotation components
    var rA = - cA * sG - sA * sB * cG;
    var rB = - sA * sG + cA * sB * cG;
    var rC = - cB * cG;

    // Calculate compass heading
    var compassHeading = Math.atan(rA / rB);

    // Convert from half unit circle to whole unit circle
    if(rB < 0) {
      compassHeading += Math.PI;
    }else if(rA < 0) {
      compassHeading += 2 * Math.PI;
    }

    // Convert radians to degrees
    compassHeading *= 180 / Math.PI;

    return compassHeading;

  }

function updateHeading() {
  window.addEventListener('deviceorientation', function(evt) {

    var heading = null;

    if(evt.absolute === true && evt.alpha !== null) {
      heading = compassHeading(evt.alpha, evt.beta, evt.gamma);
    }
    console.log(heading);
    $('.content').append("<h1>" + heading + "</h1>");
    // Do something with 'heading'...

  }, false);
}

        var socket = io();
        // When people connect
        socket.on('connect', function(){
          //console.log(window.location.href);
          socket.emit('register', window.location.href);
        });
        // Timer for position update
        setInterval(()=>getPos(), 1000);
        setInterval(()=>updateHeading(), 250);
        // Console logging the {lat, long, id}     -- MIGHT NEED TO ADD ROOM ID TO THIS?
        socket.on('lat long1', function(msg){
          console.log(msg);
        });
        socket.on('fuck off', function(){
          alert('room is full, sedning to the goog');
          window.location.assign("www.google.com");
        });

      // Gets position from browser
      function getPos() {
        if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(this.setPos);

        } else {
            console.log("Geolocation is not supported by this browser.");
        }
      }
      function setPos(position) {
        var socket = io();
        let mylat = position.coords.latitude;
        let mylong = position.coords.longitude;
        socket.emit('lat long1', {mylat, mylong});

        //console.log(mylat, mylong);

      }

      function getHeading(gps1, gps2){
          gpsHeading.calculate(gps1, gps2, function(heading) {
             return (heading.degree);
            //   console.log(heading.radian);

          });
       }


       function getHeadingSync(gps1, gps2){
           var heading = gpsHeading.calculateSync(gps1, gps2);
           return (heading.degree);
        //    console.log(heading.radian);
        }


    </script>


    <div id="wrapper">

        <!-- Header -->
            <header id="header" class="alt">
                <i class="fa fa-search" style = "size:50px"></i>
                <h1>F i i n d</h1>
                <p>D i s t a n c e<p/>
                <!-- built by <a href="https://twitter.com/ajlkn">@ajlkn</a> for <a href="https://html5up.net">HTML5 UP</a>.</p> -->
            </header>

        <!-- Nav -->

        <!-- Main -->
            <div id="main">

                <!-- Introduction -->
                     <section id="intro" class="main">
                        <div class="spotlight">

                            <div class="content">
                                    <img id = "filthy" src= "/images/Salamander_Man.png"
                                    style ="width: 220px;height:160px;"/>

                            </div>

                        </div>
                     </section>
            </div>
    </div>



  </body>


</html>
